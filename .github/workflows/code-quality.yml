name: Code Quality

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  code-quality:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements-dev.txt

    - name: Format code with Black
      run: black backend/ frontend/ tests/
      continue-on-error: true

    - name: Sort imports with isort
      run: isort backend/ frontend/ tests/
      continue-on-error: true

    - name: Create Pull Request with formatting changes
      if: always()
      uses: peter-evans/create-pull-request@v5
      with:
        commit-message: 'style: format code with Black and isort'
        title: 'Style: Format code'
        body: 'Automatic code formatting with Black and isort'
        branch: style/auto-format
        delete-branch: true
      continue-on-error: true
